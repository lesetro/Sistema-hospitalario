extends ../../../dashboard/admin/layout

block content
  .container-fluid
    //- ENCABEZADO
    .row.mb-4
      .col-md-12
        .d-flex.justify-content-between.align-items-center
          h2
            i.fas.fa-calendar-alt.me-2
            | Gestión de Turnos y Listas de Espera
          .btn-group
            button#btnActualizar.btn.btn-primary
              i.fas.fa-sync-alt.me-2
              | Actualizar
            a.btn.btn-info(href='/admisiones')
              i.fas.fa-clipboard-list.me-2
              | Ir a Admisiones

    //- LOADING
    #loading.text-center.d-none
      .spinner-border(role='status')
      p.mt-2 Cargando datos...

    //- ESTADÍSTICAS
    .row.mb-4
      .col-md-3
        .card.bg-primary.text-white
          .card-body.text-center
            h3#turnos-total 0
            p.mb-0 Total Turnos
      .col-md-3
        .card.bg-warning
          .card-body.text-center
            h3#turnos-pendientes 0
            p.mb-0 Turnos Pendientes
      .col-md-3
        .card.bg-info.text-white
          .card-body.text-center
            h3#listas-total 0
            p.mb-0 Total en Lista
      .col-md-3
        .card.bg-danger.text-white
          .card-body.text-center
            h3#listas-pendientes 0
            p.mb-0 Listas Pendientes

    //- FILTROS
    .row.mb-4
      .col-md-12
        .card
          .card-header
            h5.mb-0
              i.fas.fa-filter.me-2
              | Filtros
          .card-body
            form#formFiltros(method='GET')
              .row
                .col-md-3
                  label.form-label Fecha
                  input.form-control(type='date' name='fecha')
                .col-md-3
                  label.form-label Estado Turno
                  select.form-select(name='estado_turno')
                    option(value='') Todos
                    option(value='PENDIENTE') Pendiente
                    option(value='CONFIRMADO') Confirmado
                    option(value='COMPLETADO') Completado
                    option(value='CANCELADO') Cancelado
                .col-md-3
                  label.form-label Estado Lista
                  select.form-select(name='estado_lista')
                    option(value='') Todos
                    option(value='PENDIENTE') Pendiente
                    option(value='ASIGNADO') Asignado
                    option(value='COMPLETADO') Completado
                    option(value='CANCELADO') Cancelado
                .col-md-3.d-flex.align-items-end
                  button.btn.btn-primary.w-100(type='submit')
                    i.fas.fa-search.me-2
                    | Buscar

    //- TABS
    ul#myTab.nav.nav-tabs.mb-3(role='tablist')
      li.nav-item(role='presentation')
        button#turnos-tab.nav-link.active(
          data-bs-toggle='tab' 
          data-bs-target='#turnos' 
          type='button'
        ) 
          i.fas.fa-calendar-check.me-2
          | Turnos Asignados
      li.nav-item(role='presentation')
        button#listas-tab.nav-link(
          data-bs-toggle='tab' 
          data-bs-target='#listas' 
          type='button'
        ) 
          i.fas.fa-clock.me-2
          | Lista de Espera

    //- CONTENIDO DE TABS
    .tab-content#myTabContent
      //- TAB: TURNOS
      #turnos.tab-pane.fade.show.active(role='tabpanel')
        .card
          .card-header.bg-primary.text-white
            h5.mb-0
              i.fas.fa-calendar-alt.me-2
              | Turnos Registrados
          .card-body
            .table-responsive
              table.table.table-hover.table-striped
                thead
                  tr
                    th ID
                    th Fecha
                    th Hora
                    th Paciente
                    th Médico
                    th Estado
                    th Acciones
                tbody#tabla-turnos-body
                  tr
                    td.text-center(colspan='7') Cargando...

      //- TAB: LISTAS DE ESPERA
      #listas.tab-pane.fade(role='tabpanel')
        .card
          .card-header.bg-warning
            h5.mb-0
              i.fas.fa-users.me-2
              | Pacientes en Lista de Espera
          .card-body
            .table-responsive
              table.table.table-hover.table-striped
                thead
                  tr
                    th ID
                    th Paciente
                    th Prioridad
                    th Días Esperando
                    th Tipo
                    th Estado
                    th Turno Asignado
                    th Acciones
                tbody#tabla-listas-body
                  tr
                    td.text-center(colspan='8') Cargando...

  //- ============================================================================
  //- MODAL: VER DETALLES DE PACIENTE
  //- ============================================================================
  #modalDetallesPaciente.modal.fade(tabindex='-1')
    .modal-dialog.modal-xl
      .modal-content
        .modal-header.bg-info.text-white
          h5.modal-title
            i.fas.fa-user-circle.me-2
            | Detalles del Paciente
          button.btn-close.btn-close-white(type='button' data-bs-dismiss='modal')
        .modal-body
          //- DATOS PERSONALES
          .card.mb-3
            .card-header.bg-light
              h6.mb-0
                i.fas.fa-id-card.me-2
                | Información Personal
            .card-body
              .row
                .col-md-4
                  p.mb-2
                    strong Nombre:
                    |  
                    span#detalle-nombre
                .col-md-4
                  p.mb-2
                    strong DNI:
                    |  
                    span#detalle-dni
                .col-md-4
                  p.mb-2
                    strong Sexo:
                    |  
                    span#detalle-sexo
              .row
                .col-md-4
                  p.mb-2
                    strong Email:
                    |  
                    span#detalle-email
                .col-md-4
                  p.mb-2
                    strong Teléfono:
                    |  
                    span#detalle-telefono
                .col-md-4
                  p.mb-2
                    strong Obra Social:
                    |  
                    span#detalle-obra-social

          //- ESTADÍSTICAS RÁPIDAS
          .row.mb-3
            .col-md-4
              .card.bg-primary.text-white
                .card-body.text-center
                  h4#stat-admisiones 0
                  p.mb-0 Admisiones
            .col-md-4
              .card.bg-success.text-white
                .card-body.text-center
                  h4#stat-turnos 0
                  p.mb-0 Turnos Totales
            .col-md-4
              .card.bg-warning
                .card-body.text-center
                  h4#stat-pendientes 0
                  p.mb-0 Pendientes

          //- HISTORIAL DE ADMISIONES
          .card.mb-3
            .card-header.bg-light
              h6.mb-0
                i.fas.fa-clipboard-list.me-2
                | Historial de Admisiones
            .card-body
              .table-responsive
                table.table.table-sm
                  thead
                    tr
                      th Fecha
                      th Médico
                      th Sector
                      th Estado
                  tbody#historial-admisiones
                    tr
                      td.text-center(colspan='4') Cargando...

          //- HISTORIAL DE TURNOS
          .card
            .card-header.bg-light
              h6.mb-0
                i.fas.fa-calendar.me-2
                | Historial de Turnos
            .card-body
              .table-responsive
                table.table.table-sm
                  thead
                    tr
                      th Fecha
                      th Hora
                      th Médico
                      th Estado
                  tbody#historial-turnos
                    tr
                      td.text-center(colspan='4') Cargando...

        .modal-footer
          button.btn.btn-secondary(type='button' data-bs-dismiss='modal') Cerrar

  //- ============================================================================
  //-  MODAL ASIGNAR TURNO
  //- ============================================================================
  #modalAsignarTurno.modal.fade(tabindex='-1')
    .modal-dialog
      .modal-content
        .modal-header.bg-success.text-white
          h5.modal-title
            i.fas.fa-calendar-plus.me-2
            | Asignar Turno
          button.btn-close.btn-close-white(type='button' data-bs-dismiss='modal')
        .modal-body
          .alert.alert-info
            i.fas.fa-info-circle.me-2
            strong Paciente: 
            span#asignar-paciente-nombre

          form#formAsignarTurno
            input#asignar-lista-id(type='hidden')
          
            .row.mb-3
              .col-md-6
                label.form-label(for='asignar-medico') 
                  | Médico 
                  span.text-danger *
                select#asignar-medico.form-select(required)
                  option(value='') Seleccione médico...
              .col-md-6
                label.form-label(for='asignar-fecha') 
                  | Fecha 
                  span.text-danger *
                input#asignar-fecha.form-control(type='date' required)
          
            .mb-3
              label.form-label(for='asignar-hora') 
                | Horario Disponible 
                span.text-danger *
              select#asignar-hora.form-select(required disabled)
                option(value='') Seleccione médico y fecha primero
              #info-horario.mt-1
          
            .mb-3
              label.form-label(for='asignar-sector') Sector
              select#asignar-sector.form-select
                option(value='') Seleccione sector (opcional)
                if sectores && sectores.length
                  each sector in sectores
                    option(value=sector.id)= sector.nombre

        .modal-footer
          button.btn.btn-secondary(type='button' data-bs-dismiss='modal') Cancelar
          button#btnConfirmarAsignacion.btn.btn-success(type='button')
            i.fas.fa-check.me-2
            | Asignar Turno


  //- ============================================================================
  //- MODAL: CAMBIAR ESTADO DE TURNO
  //- ============================================================================
  #modalCambiarEstado.modal.fade(tabindex='-1')
    .modal-dialog
      .modal-content
        .modal-header.bg-warning
          h5.modal-title
            i.fas.fa-edit.me-2
            | Cambiar Estado del Turno
          button.btn-close(type='button' data-bs-dismiss='modal')
        .modal-body
          input#cambiar-turno-id(type='hidden')
          
          .alert.alert-info
            p.mb-1
              strong Estado actual: 
              span#cambiar-estado-actual.badge.bg-primary
            p.mb-0.small Seleccione el nuevo estado para este turno

          .mb-3
            label.form-label(for='cambiar-nuevo-estado') 
              | Nuevo Estado 
              span.text-danger *
            select#cambiar-nuevo-estado.form-select(required)
              option(value='') Seleccione...
              option(value='PENDIENTE') Pendiente
              option(value='CONFIRMADO') Confirmado (en proceso)
              option(value='COMPLETADO') Completado
              option(value='CANCELADO') Cancelado

          .alert.alert-warning.mb-0
            i.fas.fa-exclamation-triangle.me-2
            small
              strong Nota: 
              | Al completar o cancelar el turno, también se actualizará el estado de la lista de espera.

        .modal-footer
          button.btn.btn-secondary(type='button' data-bs-dismiss='modal') Cancelar
          button#btnConfirmarCambioEstado.btn.btn-warning(type='button')
            i.fas.fa-save.me-2
            | Guardar Cambio

block scripts
  script(src='/js/admin/turnos.js')
