extends ../../../dashboard/admin/layout

block content
  .container-fluid
    //- ALERTAS
    #alerta-container

    //- LOADING
    #loading.text-center.d-none.my-4
      .spinner-border(role='status')
      p.mt-2 Cargando...

    //- ENCABEZADO
    .row.mb-4
      .col-md-12
        .d-flex.justify-content-between.align-items-center
          h2
            i.fas.fa-users.me-2
            | Gestión de Pacientes
          .btn-group
            button#btnLimpiarFiltros.btn.btn-secondary
              i.fas.fa-eraser.me-2
              | Limpiar Filtros
            a.btn.btn-primary(href='/admisiones/crear')
              i.fas.fa-user-plus.me-2
              | Registrar Paciente (en Admisión)

    //- FILTROS
    .row.mb-4
      .col-md-12
        .card
          .card-header
            h5.mb-0
              i.fas.fa-filter.me-2
              | Filtros de Búsqueda
          .card-body
            .row
              .col-md-4
                label.form-label Búsqueda
                input#busqueda.form-control(
                  type='text'
                  placeholder='DNI, nombre, email...'
                )
              .col-md-3
                label.form-label Estado
                select#filtro-estado.form-select
                  option(value='') Todos
                  option(value='Activo') Activo
                  option(value='Inactivo') Inactivo
                  option(value='Baja') Baja
              .col-md-3
                label.form-label Obra Social
                select#filtro-obra-social.form-select
                  option(value='') Todas
                  if obrasSociales && obrasSociales.length
                    each os in obrasSociales
                      option(value=os.id)= os.nombre

    //- TABLA DE PACIENTES
    .row
      .col-md-12
        .card
          .card-header.bg-primary.text-white
            h5.mb-0
              i.fas.fa-table.me-2
              | Listado de Pacientes
          .card-body
            .table-responsive
              table.table.table-hover.table-striped
                thead
                  tr
                    th DNI
                    th Nombre Completo
                    th Email
                    th Teléfono
                    th Sexo
                    th Obra Social
                    th Estado
                    th Acciones
                tbody#tabla-pacientes-body
                  tr
                    td.text-center(colspan='8') Cargando pacientes...

          .card-footer
            #paginacion

  //- ============================================================================
  //- MODAL: VER DETALLES
  //- ============================================================================
  #modalDetalles.modal.fade(tabindex='-1')
    .modal-dialog.modal-xl
      .modal-content
        .modal-header.bg-info.text-white
          h5.modal-title
            i.fas.fa-user-circle.me-2
            | Detalles del Paciente
          button.btn-close.btn-close-white(type='button' data-bs-dismiss='modal')
        .modal-body
          //- DATOS PERSONALES
          .card.mb-3
            .card-header.bg-light
              h6.mb-0
                i.fas.fa-id-card.me-2
                | Información Personal
            .card-body
              .row
                .col-md-3
                  p.mb-2
                    strong Nombre:
                    br
                    span#detalle-nombre
                .col-md-3
                  p.mb-2
                    strong DNI:
                    br
                    span#detalle-dni
                .col-md-3
                  p.mb-2
                    strong Sexo:
                    br
                    span#detalle-sexo
                .col-md-3
                  p.mb-2
                    strong Fecha Nac.:
                    br
                    span#detalle-fecha-nacimiento
              .row
                .col-md-4
                  p.mb-2
                    strong Email:
                    br
                    span#detalle-email
                .col-md-4
                  p.mb-2
                    strong Teléfono:
                    br
                    span#detalle-telefono
                .col-md-4
                  p.mb-2
                    strong Obra Social:
                    br
                    span#detalle-obra-social
              .row
                .col-md-3
                  p.mb-2
                    strong Estado:
                    br
                    span#detalle-estado
                .col-md-3
                  p.mb-2
                    strong Fecha Ingreso:
                    br
                    span#detalle-fecha-ingreso
              .row
                .col-md-12
                  p.mb-0
                    strong Observaciones:
                    br
                    span#detalle-observaciones

          //- ESTADÍSTICAS
          .row.mb-3
            .col-md-3
              .card.bg-primary.text-white
                .card-body.text-center
                  h4#stat-admisiones 0
                  p.mb-0 Admisiones
            .col-md-3
              .card.bg-success.text-white
                .card-body.text-center
                  h4#stat-turnos 0
                  p.mb-0 Turnos
            .col-md-3
              .card.bg-warning
                .card-body.text-center
                  h4#stat-turnos-pendientes 0
                  p.mb-0 Turnos Pendientes
            .col-md-3
              .card.bg-info.text-white
                .card-body.text-center
                  h4#stat-internaciones 0
                  p.mb-0 Internaciones

          //- HISTORIAL DE ADMISIONES
          .card.mb-3
            .card-header.bg-light
              h6.mb-0
                i.fas.fa-clipboard-list.me-2
                | Últimas Admisiones
            .card-body
              .table-responsive
                table.table.table-sm
                  thead
                    tr
                      th Fecha
                      th Médico
                      th Sector
                      th Estado
                  tbody#historial-admisiones
                    tr
                      td.text-center(colspan='4') Cargando...

          //- HISTORIAL DE TURNOS
          .card
            .card-header.bg-light
              h6.mb-0
                i.fas.fa-calendar.me-2
                | Últimos Turnos
            .card-body
              .table-responsive
                table.table.table-sm
                  thead
                    tr
                      th Fecha
                      th Hora
                      th Médico
                      th Estado
                  tbody#historial-turnos
                    tr
                      td.text-center(colspan='4') Cargando...

        .modal-footer
          button.btn.btn-secondary(type='button' data-bs-dismiss='modal') Cerrar

  //- ============================================================================
  //- MODAL: EDITAR PACIENTE
  //- ============================================================================
  #modalEditar.modal.fade(tabindex='-1')
    .modal-dialog
      .modal-content
        .modal-header.bg-warning
          h5.modal-title
            i.fas.fa-edit.me-2
            | Editar Paciente
          button.btn-close(type='button' data-bs-dismiss='modal')
        .modal-body
          input#editar-id(type='hidden')
          
          .alert.alert-info
            i.fas.fa-info-circle.me-2
            small
              strong Nota: 
              | Solo se pueden modificar datos de contacto y observaciones. Los datos personales no son editables.

          .mb-3
            label.form-label Nombre Completo
            input#editar-nombre.form-control(type='text' disabled)

          .mb-3
            label.form-label DNI
            input#editar-dni.form-control(type='text' disabled)

          .mb-3
            label.form-label Email
            input#editar-email.form-control(type='email' required)

          .mb-3
            label.form-label Teléfono
            input#editar-telefono.form-control(type='tel')

          .mb-3
            label.form-label Obra Social
            select#editar-obra-social.form-select
              option(value='') Sin obra social
              if obrasSociales && obrasSociales.length
                each os in obrasSociales
                  option(value=os.id)= os.nombre

          .mb-3
            label.form-label Observaciones
            textarea#editar-observaciones.form-control(rows='3')

        .modal-footer
          button.btn.btn-secondary(type='button' data-bs-dismiss='modal') Cancelar
          button#btnGuardarEdicion.btn.btn-warning
            i.fas.fa-save.me-2
            | Guardar Cambios

  //- ============================================================================
  //- MODAL: DAR DE BAJA
  //- ============================================================================
  #modalBaja.modal.fade(tabindex='-1')
    .modal-dialog
      .modal-content
        .modal-header.bg-danger.text-white
          h5.modal-title
            i.fas.fa-user-times.me-2
            | Dar de Baja al Paciente
          button.btn-close.btn-close-white(type='button' data-bs-dismiss='modal')
        .modal-body
          input#baja-id(type='hidden')
          
          .alert.alert-warning
            i.fas.fa-exclamation-triangle.me-2
            strong Advertencia: 
            | Esta acción dará de baja al paciente en el sistema. No podrá asignar nuevos turnos ni internaciones.

          .mb-3
            label.form-label 
              | Motivo de la Baja 
              span.text-danger *
            textarea#baja-motivo.form-control(rows='3' required placeholder='Ingrese el motivo de la baja...')

          .alert.alert-info.mb-0
            i.fas.fa-info-circle.me-2
            small El paciente puede ser reactivado posteriormente si es necesario.

        .modal-footer
          button.btn.btn-secondary(type='button' data-bs-dismiss='modal') Cancelar
          button#btnConfirmarBaja.btn.btn-danger
            i.fas.fa-check.me-2
            | Confirmar Baja

block scripts
  script(src='/js/admin/paciente.js')
