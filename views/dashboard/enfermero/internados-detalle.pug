extends ../../layouts/enfermero-layout

block content
  .container-fluid
    .row.mb-3
      .col-12
        a.btn.btn-secondary(href='/enfermero/internados')
          i.fas.fa-arrow-left.me-2
          | Volver

    .row
      // Información del paciente
      .col-lg-4.mb-4
        .card.border-0.shadow-sm
          .card-header(class=internacion.estado_paciente === 'Critico' ? 'bg-danger text-white' : internacion.estado_paciente === 'Grave' ? 'bg-warning' : 'bg-success text-white')
            h5.mb-0
              i.fas.fa-user-injured.me-2
              | Paciente Internado
          .card-body
            .text-center.mb-3
              h4= `${internacion.paciente.usuario.nombre} ${internacion.paciente.usuario.apellido}`
              p.text-muted.mb-0 DNI: #{internacion.paciente.usuario.dni}
            
            dl.row.mb-0
              dt.col-sm-5 Estado:
              dd.col-sm-7
                case internacion.estado_paciente
                  when 'Critico'
                    span.badge.bg-danger.fs-6 Crítico
                  when 'Grave'
                    span.badge.bg-warning.text-dark.fs-6 Grave
                  when 'Estable'
                    span.badge.bg-success.fs-6 Estable
                  default
                    span.badge.bg-secondary.fs-6= internacion.estado_paciente
              
              dt.col-sm-5 Días internado:
              dd.col-sm-7
                strong= `${diasInternado} días`
              
              dt.col-sm-5 Ubicación:
              dd.col-sm-7
                strong Habitación #{internacion.cama.habitacion.numero}
                br
                | Cama #{internacion.cama.numero}
                br
                small.text-muted= internacion.cama.habitacion.sector.nombre
              
              dt.col-sm-5 Médico:
              dd.col-sm-7 Dr. #{internacion.medico.usuario.nombre} #{internacion.medico.usuario.apellido}
              
              dt.col-sm-5 Tipo:
              dd.col-sm-7= internacion.tipoInternacion.nombre
              
              dt.col-sm-5 Fecha ingreso:
              dd.col-sm-7= new Date(internacion.fecha_inicio).toLocaleDateString('es-AR')
              
              if internacion.estado_operacion !== 'No aplica'
                dt.col-sm-5 Operación:
                dd.col-sm-7
                  span.badge.bg-info= internacion.estado_operacion

        // Acciones rápidas
        .card.border-0.shadow-sm.mt-3
          .card-body
            button.btn.btn-primary.w-100.mb-2(onclick=`registrarEvolucion(${internacion.id})`)
              i.fas.fa-notes-medical.me-2
              | Registrar Evolución
            button.btn.btn-warning.w-100.mb-2(onclick=`cambiarEstado(${internacion.id})`)
              i.fas.fa-edit.me-2
              | Cambiar Estado
            a.btn.btn-success.w-100(href=`/enfermero/signos-vitales/registro?paciente_id=${internacion.paciente_id}`)
              i.fas.fa-heartbeat.me-2
              | Signos Vitales

      // Historial
      .col-lg-8.mb-4
        // Evaluaciones de enfermería
        .card.border-0.shadow-sm.mb-3
          .card-header.bg-white
            h5.mb-0
              i.fas.fa-clipboard-check.me-2
              | Evaluaciones de Enfermería
          .card-body.p-0
            if evaluacionesEnfermeria.length > 0
              .list-group.list-group-flush
                each evaluacion in evaluacionesEnfermeria
                  .list-group-item
                    .d-flex.justify-content-between.align-items-start
                      div
                        strong= new Date(evaluacion.fecha).toLocaleString('es-AR')
                        br
                        small.text-muted Enf. #{evaluacion.enfermero.usuario.nombre} #{evaluacion.enfermero.usuario.apellido}
                        if evaluacion.signos_vitales
                          br
                          small= evaluacion.signos_vitales
                        if evaluacion.observaciones
                          br
                          small.text-muted= evaluacion.observaciones.substring(0, 150) + '...'
                      div
                        case evaluacion.tipo_egreso
                          when 'PROCEDIMIENTO_COMPLETADO'
                            span.badge.bg-success Completado
                          when 'DERIVACION_MEDICO'
                            span.badge.bg-primary Médico notificado
                          when 'DERIVACION_URGENCIA'
                            span.badge.bg-danger Urgencia
                          default
                            span.badge.bg-warning Pendiente
            else
              .p-3.text-center.text-muted
                p.mb-0 No hay evaluaciones registradas

        // Controles
        .card.border-0.shadow-sm
          .card-header.bg-white
            h5.mb-0
              i.fas.fa-temperature-high.me-2
              | Controles de Enfermería
          .card-body.p-0
            if controles.length > 0
              .table-responsive
                table.table.table-sm.mb-0
                  thead.table-light
                    tr
                      th Fecha
                      th Enfermero
                      th Peso/Altura
                      th P.A.
                      th Temp.
                  tbody
                    each control in controles
                      tr
                        td
                          small= new Date(control.created_at).toLocaleString('es-AR')
                        td
                          small= `${control.evaluacion.enfermero.usuario.nombre} ${control.evaluacion.enfermero.usuario.apellido}`
                        td
                          if control.peso && control.altura
                            small= `${control.peso}kg / ${control.altura}cm`
                          else
                            small.text-muted N/A
                        td
                          small= control.presion_arterial || 'N/A'
                        td
                          small= control.temperatura ? `${control.temperatura}°C` : 'N/A'
            else
              .p-3.text-center.text-muted
                p.mb-0 No hay controles registrados

block scripts
  script.
    // Incluir funciones del modal desde internados.js
    const internacionId = !{internacion.id};
  script(src='/js/enfermero/internados.js')