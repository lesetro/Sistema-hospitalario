extends ../../layouts/enfermero-layout

block content
  .container-fluid
    .row.mb-3
      .col-12
        a.btn.btn-secondary(href='/enfermero/signos-vitales')
          i.fas.fa-arrow-left.me-2
          | Volver

    .row
      // Formulario de registro
      .col-lg-8
        .card.border-0.shadow-sm
          .card-header.bg-success.text-white
            h4.mb-0
              i.fas.fa-chart-line.me-2
              | Registrar Signos Vitales
          .card-body
            // Información del paciente
            .alert.alert-info
              .row
                .col-md-6
                  p.mb-1
                    strong Paciente:
                    span.ms-2= `${paciente.usuario.nombre} ${paciente.usuario.apellido}`
                .col-md-6
                  p.mb-1
                    strong DNI:
                    span.ms-2= paciente.usuario.dni
                .col-md-6
                  p.mb-1
                    strong Edad:
                    - const edad = Math.floor((new Date() - new Date(paciente.usuario.fecha_nacimiento)) / (1000 * 60 * 60 * 24 * 365))
                    span.ms-2= `${edad} años`
                .col-md-6
                  p.mb-1
                    strong Sexo:
                    span.ms-2= paciente.usuario.sexo

            // Formulario
            form#form-signos-vitales
              input(type='hidden' name='paciente_id' value=paciente.id)
              
              .row.g-3
                // Presión Arterial
                .col-md-6
                  label.form-label
                    i.fas.fa-heart.me-2.text-danger
                    strong Presión Arterial *
                  .input-group
                    input.form-control(type='text' name='presion_arterial' id='presion-arterial' placeholder='120/80' required pattern='\\d{2,3}/\\d{2,3}')
                    span.input-group-text mmHg
                  small.form-text.text-muted Normal: 90/60 - 140/90
                
                // Frecuencia Cardíaca
                .col-md-6
                  label.form-label
                    i.fas.fa-heartbeat.me-2.text-danger
                    strong Frecuencia Cardíaca *
                  .input-group
                    input.form-control(type='number' name='frecuencia_cardiaca' id='frecuencia-cardiaca' placeholder='70' required min='40' max='200')
                    span.input-group-text lpm
                  small.form-text.text-muted Normal: 60-100 lpm
                
                // Frecuencia Respiratoria
                .col-md-6
                  label.form-label
                    i.fas.fa-lungs.me-2.text-primary
                    strong Frecuencia Respiratoria *
                  .input-group
                    input.form-control(type='number' name='frecuencia_respiratoria' id='frecuencia-respiratoria' placeholder='16' required min='8' max='40')
                    span.input-group-text rpm
                  small.form-text.text-muted Normal: 12-20 rpm
                
                // Temperatura
                .col-md-6
                  label.form-label
                    i.fas.fa-thermometer-half.me-2.text-warning
                    strong Temperatura *
                  .input-group
                    input.form-control(type='number' step='0.1' name='temperatura' id='temperatura' placeholder='36.5' required min='35' max='42')
                    span.input-group-text °C
                  small.form-text.text-muted Normal: 36-37.5°C
                
                // Saturación de Oxígeno
                .col-md-6
                  label.form-label
                    i.fas.fa-wind.me-2.text-info
                    strong Saturación de Oxígeno *
                  .input-group
                    input.form-control(type='number' name='saturacion_oxigeno' id='saturacion-oxigeno' placeholder='98' required min='70' max='100')
                    span.input-group-text %
                  small.form-text.text-muted Normal: >95%
                
                // Escala de Dolor
                .col-md-6
                  label.form-label
                    i.fas.fa-face-frown.me-2.text-secondary
                    | Escala de Dolor (0-10)
                  input.form-range(type='range' name='dolor_escala' id='dolor-escala' min='0' max='10' value='0' oninput='actualizarDolor(this.value)')
                  .d-flex.justify-content-between
                    small 0 (Sin dolor)
                    strong#valor-dolor 0
                    small 10 (Máximo)
                
                // Observaciones
                .col-12
                  label.form-label
                    i.fas.fa-notes-medical.me-2
                    | Observaciones
                  textarea.form-control(name='observaciones' rows='3' placeholder='Observaciones adicionales...')
                
                // Alertas
                .col-12#alertas-container

              // Botones
              .d-flex.justify-content-between.mt-4
                button.btn.btn-secondary(type='button' onclick='window.history.back()')
                  i.fas.fa-times.me-2
                  | Cancelar
                button.btn.btn-success.btn-lg(type='submit')
                  i.fas.fa-save.me-2
                  | Registrar Signos Vitales

      // Historial lateral
      .col-lg-4
        .card.border-0.shadow-sm
          .card-header.bg-light
            h5.mb-0
              i.fas.fa-history.me-2
              | Historial Reciente
          .card-body.p-0
            if historial.length > 0
              .list-group.list-group-flush
                each eval in historial
                  .list-group-item
                    .d-flex.justify-content-between.align-items-start
                      div
                        small.text-muted= new Date(eval.fecha).toLocaleString('es-AR')
                        br
                        small= eval.signos_vitales || 'Sin datos'
                      span.badge.bg-primary= `${eval.enfermero.usuario.nombre.charAt(0)}${eval.enfermero.usuario.apellido.charAt(0)}`
            else
              .p-3.text-center.text-muted
                i.fas.fa-clock.fa-2x.mb-2
                p.mb-0.small Sin historial previo

block scripts
  script(src='/js/enfermero/signos-vitales-registro.js')