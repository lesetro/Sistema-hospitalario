doctype html
html(lang="es")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title= title || "Hospital Central"
    
    //- Bootstrap CSS
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css", rel="stylesheet")
    //- Bootstrap Icons
    link(href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css", rel="stylesheet")
    
    //- Estilos personalizados
    style.
      .hero-section {
        background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
      }
      .card {
        transition: transform 0.2s;
      }
      .card:hover {
        transform: translateY(-5px);
      }
      .navbar-brand {
        font-weight: bold;
      }

  body
    //- Navbar
    nav.navbar.navbar-expand-lg.navbar-dark.bg-primary.sticky-top
      .container
        a.navbar-brand(href="/")
          i.bi.bi-hospital.me-2
          | Hospital Central
        
        button.navbar-toggler(type="button", data-bs-toggle="collapse", data-bs-target="#navbarNav")
          span.navbar-toggler-icon
        
        .collapse.navbar-collapse#navbarNav
          ul.navbar-nav.me-auto
            li.nav-item
              a.nav-link(href="/") 
                i.bi.bi-house.me-1
                | Inicio
            li.nav-item
              a.nav-link(href="/quienes-somos")
                i.bi.bi-info-circle.me-1
                | Qui√©nes Somos
            li.nav-item
              a.nav-link(href="/especialidades")
                i.bi.bi-heart-pulse.me-1
                | Especialidades
            li.nav-item
              a.nav-link(href="/reclamos")
                i.bi.bi-chat-dots.me-1
                | Reclamos/Consultas
          
          //- ‚úÖ Men√∫ de usuario con validaciones
          .navbar-nav
            if user && user.nombre
              //- Usuario autenticado
              .nav-item.dropdown
                a.nav-link.dropdown-toggle(href="#", role="button", data-bs-toggle="dropdown")
                  i.bi.bi-person-circle.me-1
                  | #{user.nombre} #{user.apellido || ''}
                  if user.rol_nombre || user.rol
                    span.badge.bg-light.text-primary.ms-2= user.rol_nombre || user.rol
                
                ul.dropdown-menu.dropdown-menu-end
                  li
                    //-  OPCI√ìN 1: Usar rol_ruta (RECOMENDADO)
                    if user.rol_ruta
                      a.dropdown-item(href=`/${user.rol_ruta}`)
                        i.bi.bi-speedometer2.me-2
                        | Mi Dashboard
                    //-  OPCI√ìN 2: Usar helper function
                    else if user.rol
                      - var rutaDashboard = user.rol === 'ADMINISTRATIVO' ? '/admin' : `/${user.rol.toLowerCase()}`
                      a.dropdown-item(href=rutaDashboard)
                        i.bi.bi-speedometer2.me-2
                        | Mi Dashboard
                    //-  OPCI√ìN 3: Fallback si no hay ninguno
                    else
                      a.dropdown-item(href="/") 
                        i.bi.bi-speedometer2.me-2
                        | Inicio
                  
                  li
                    hr.dropdown-divider
                  
                  li
                    a.dropdown-item(href="#" onclick="logout(); return false;")
                      i.bi.bi-box-arrow-right.me-2
                      | Cerrar Sesi√≥n
            else
              //- Usuario no autenticado
              a.nav-link.btn.btn-outline-light(href="/auth/login")
                i.bi.bi-box-arrow-in-right.me-1
                | Ingresar al Sistema

    //- Contenido principal
    main
      block content

    //- Footer
    footer.bg-dark.text-white.py-4.mt-5
      .container
        .row
          .col-md-6
            h5 üè• Hospital Central
            p Proyecto Universitario - Sistema de Gesti√≥n Hospitalaria
          .col-md-6.text-md-end
            p.mb-0 
              i.bi.bi-c-circle
              |  2024 - Todos los derechos reservados

    //- Bootstrap JS
    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js")
    
    //- Script global de autenticaci√≥n
    script.
      // Funci√≥n de logout
      function logout() {
        // Limpiar localStorage y sessionStorage
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        sessionStorage.removeItem('token');
        sessionStorage.removeItem('user');
        
        // Limpiar cookies
        document.cookie = 'token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        
        // Mostrar mensaje
        alert('Sesi√≥n cerrada correctamente');
        
        // Redirigir a login
        window.location.href = '/auth/logout';
      }
      
      // Funci√≥n para mostrar mensajes
      function showMessage(message, type) {
        const alertClass = {
          'success': 'alert-success',
          'error': 'alert-danger',
          'warning': 'alert-warning',
          'info': 'alert-info'
        }[type] || 'alert-info';

        const alert = document.createElement('div');
        alert.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
        alert.style.top = '20px';
        alert.style.right = '20px';
        alert.style.zIndex = '9999';
        alert.style.minWidth = '300px';
        alert.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

        document.body.appendChild(alert);

        setTimeout(() => {
          if (alert.parentNode) {
            alert.remove();
          }
        }, 5000);
      }
    
    block scripts
